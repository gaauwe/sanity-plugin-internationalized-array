function e(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function n(n){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?e(Object(r),!0).forEach((function(e){t(n,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))}))}return n}function t(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}import*as i from"suspend-react";import{suspend as r}from"suspend-react";import{jsx as l,jsxs as a,Fragment as o}from"react/jsx-runtime";import{useClient as d,useFormBuilder as u,insert as s,setIfMissing as c,set as p,ArrayOfObjectsItem as g,defineField as y,useFormValue as h,unset as f,definePlugin as m}from"sanity";import v,{memo as b,useCallback as k,useMemo as _,useEffect as O}from"react";import{get as j}from"lodash";import{Card as A,Stack as P,Text as w,Code as C,useToast as x,Grid as z,Button as V,Spinner as I,Label as T,MenuButton as D,Menu as S,MenuItem as B,Flex as E}from"@sanity/ui";import{AddIcon as U,RemoveCircleIcon as F}from"@sanity/icons";import q from"fast-deep-equal";const N="sanity-plugin-internationalized-array",J=()=>i.clear(["v0",N]),L=e=>i.peek(["v0",N,e]);var M=b((function(e){const n=d({apiVersion:e.apiVersion});var t;return Array.isArray(L({}))||(t=async()=>Array.isArray(e.languages)?e.languages:e.languages(n,{}),i.preload((()=>t()),["v0",N])),null}));function G(e){return function(e){return e.split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")}(function(e){return e.replace(/-([a-z])/g,(e=>e[1].toUpperCase()))}(e))}function H(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n?["internationalizedArray",G(e),"Value"].join(""):["internationalizedArray",G(e)].join("")}const K=(e,n)=>{if(!e||!n)return{};const t=e||{};return Object.keys(t).reduce(((e,i)=>(e[i]=j(n,t[i]),e)),{})},Q={languages:[{id:"en",title:"English"},{id:"no",title:"Norsk"}]};function R(){return l(A,{tone:"caution",border:!0,radius:2,padding:3,children:a(P,{space:4,children:[a(w,{children:["An array of language objects must be passed into the ",l("code",{children:"internationalizedArray"})," ","helper function, each with an ",l("code",{children:"id"})," and ",l("code",{children:"title"})," field. Example:"]}),l(A,{padding:2,border:!0,radius:2,children:l(C,{size:1,language:"javascript",children:JSON.stringify(Q,null,2)})})]})})}const W=v.createContext({languages:[]}),X=W.Provider;function Y(e){const{members:t,value:i,schemaType:y,onChange:h}=e,f="boolean"==typeof y.readOnly&&y.readOnly,{options:m}=y,v=x(),{value:b}=u(),j=K(m.select,b),{apiVersion:A}=m,w=d({apiVersion:A}),C=Array.isArray(m.languages)?m.languages:r((async()=>"function"==typeof m.languages?m.languages(w,j):m.languages),["v0",N,j],{equal:q}),I=k((e=>{if(!(null==C?void 0:C.length))return;const t={_type:"".concat(y.name,"Value")},r=e?[n(n({},t),{},{_key:e})]:C.filter((e=>!(null==i?void 0:i.length)||!i.find((n=>n._key===e.id)))).map((e=>n(n({},t),{},{_key:e.id}))),l=(null==i?void 0:i.length)?i.map((e=>e)):[],a=r.map((e=>{const n=C.findIndex((n=>e._key===n.id)),t=C.slice(n+1),i=l.findIndex((e=>t.find((n=>n.id===e._key))));return i<0?l.push(e):l.splice(i,0,e),s([e],i<0?"after":"before",[i])}));h([c([]),...a])}),[C,h,y.name,i]),T=k((()=>{if(!(null==i?void 0:i.length)||!(null==C?void 0:C.length))return;const e=i.reduce(((e,n)=>{const t=C.findIndex((e=>e.id===(null==n?void 0:n._key)));return t>-1&&(e[t]=n),e}),[]).filter(Boolean);(null==i?void 0:i.length)!==e.length&&v.push({title:"There was an error reordering languages",status:"warning"}),h(p(e))}),[v,C,h,i]),D=_((()=>!(null==i?void 0:i.length)||!(null==C?void 0:C.length)||(null==i?void 0:i.every((e=>C.find((n=>(null==n?void 0:n.id)===(null==e?void 0:e._key))))))),[i,C]),S=_((()=>C&&C.length>1?C.filter((e=>null==i?void 0:i.find((n=>n._key===e.id)))):[]),[C,i]),B=_((()=>(null==i?void 0:i.length)&&S.length?i.map(((e,n)=>n===S.findIndex((n=>n.id===e._key))?null:e)).filter(Boolean):[]),[i,S]),E=_((()=>!(null==C?void 0:C.length)||(null==C?void 0:C.length)&&C.every((e=>e.id&&e.title))),[C]);return O((()=>{B.length>0&&D&&T()}),[B,D,T]),E?l(X,{value:{languages:C},children:a(P,{space:2,children:[(null==t?void 0:t.length)>0?l(o,{children:t.map((n=>"item"===n.kind?l(g,{member:n,renderItem:e.renderItem,renderField:e.renderField,renderInput:e.renderInput,renderPreview:e.renderPreview},n.key):null))}):null,(null==C?void 0:C.length)>0&&S.length<C.length?a(P,{space:2,children:[C.length>1?l(z,{columns:Math.min(C.length,5),gap:2,children:C.map((e=>l(V,{tone:"primary",mode:"ghost",fontSize:1,disabled:f||Boolean(null==i?void 0:i.find((n=>n._key===e.id))),text:e.id.toUpperCase(),icon:U,onClick:()=>I(e.id)},e.id)))}):null,l(V,{tone:"primary",mode:"ghost",disabled:f||i&&(null==i?void 0:i.length)>=(null==C?void 0:C.length),icon:U,text:(null==i?void 0:i.length)?"Add missing ".concat(C.length-i.length==1?"language":"languages"):1===C.length?"Add ".concat(C[0].title," Field"):"Add all languages",onClick:()=>I()})]}):null]})}):l(R,{})}var Z=e=>{const{apiVersion:t,select:i,languages:r,type:l}=e,a="string"==typeof l?l:l.name,o=H(a),d=H(a,!0);return y({name:o,title:"Internationalized array",type:"array",components:{input:Y},options:{apiVersion:t,select:i,languages:r},of:[y(n(n({},"string"==typeof l?{}:l),{},{name:d,type:d}))],validation:e=>e.custom((async(e,r)=>{var l,a,o;if(!e)return!0;const d=K(i,r.document),u=r.getClient({apiVersion:t}),s=Array.isArray(null==(a=null==(l=null==r?void 0:r.type)?void 0:l.options)?void 0:a.languages)?r.type.options.languages:Array.isArray(L(d))?L(d):await(null==(o=null==r?void 0:r.type)?void 0:o.options.languages(u,d));if(e&&e.length>s.length)return"Cannot be more than ".concat(1===s.length?"1 item":"".concat(s.length," items"));const c=(null==e?void 0:e.length)?e.filter((e=>!s.find((n=>e._key===n.id)))):[];if(c.length)return{message:"Array item keys must be valid languages registered to the field type",paths:c.map((e=>[{_key:e._key}]))};const p=(null==e?void 0:e.length)?e.filter((e=>Boolean(null==e?void 0:e._key))).reduce(((e,t)=>e[t._key]?n(n({},e),{},{[t._key]:[...e[t._key],t]}):n(n({},e),{},{[t._key]:[t]})),{}):{},g=Object.values(p).filter((e=>(null==e?void 0:e.length)>1)).flat();return!g.length||{message:"There can only be one field per language",paths:g.map((e=>[{_key:e._key}]))}}))})};function $(e){return"reference"===e.schemaType.name&&e.value?e.renderDefault(n(n({},e),{},{title:"",level:0})):e.children}function ee(e){if(!(null==e?void 0:e.length))return;const n=e.map((e=>e.level));return n.includes("error")?"critical":n.includes("warning")?"caution":void 0}function ne(e){const t=h(e.path.slice(0,-1)),i=n(n({},e.inputProps),{},{members:e.inputProps.members.filter((e=>"field"===e.kind&&"value"===e.name)),value:e.value}),{validation:r,value:o,onChange:d,readOnly:u}=i,{languages:s}=v.useContext(W),c=_((()=>{var e;return null!=(e=null==t?void 0:t.map((e=>e._key)))?e:[]}),[t]),g=!!(null==s?void 0:s.length)&&s.find((e=>e.id===o._key)),y=k((e=>{o&&(null==s?void 0:s.length)&&s.find((n=>n.id===e))&&d([p(e,["_key"])])}),[d,o,s]),m=k((()=>{d(f())}),[d]);return s?l(A,{paddingTop:2,tone:ee(r),children:a(P,{space:2,children:[l(A,{tone:"inherit",children:g?l(T,{muted:!0,size:1,children:o._key}):l(D,{button:l(V,{fontSize:1,text:'Change "'.concat(o._key,'"')}),id:"".concat(o._key,"-change-key"),menu:l(S,{children:s.map((e=>l(B,{disabled:c.includes(e.id),fontSize:1,text:e.id.toLocaleUpperCase(),onClick:()=>y(e.id)},e.id)))}),placement:"right",popover:{portal:!0}})}),a(E,{align:"center",gap:2,children:[l(A,{flex:1,tone:"inherit",children:e.inputProps.renderInput(e.inputProps)}),l(A,{tone:"inherit",children:l(V,{mode:"bleed",icon:F,tone:"critical",disabled:u,onClick:m})})]})]})}):l(I,{})}var te=e=>{const{type:t}=e,i=H("string"==typeof t?t:t.name,!0);return y({name:i,title:"Internationalized array ".concat(t),type:"object",components:{item:ne},fields:["string"==typeof t?y({name:"value",type:t,components:{field:$}}):n(n({},t),{},{name:"value",components:{field:$}})],preview:{select:{title:"value",subtitle:"_key"}}})};const ie={languages:[],fieldTypes:[]},re=m((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie;const{apiVersion:t="2022-11-27",select:i,languages:r,fieldTypes:d}=n(n({},ie),e);return{name:"sanity-plugin-internationalized-array",studio:Array.isArray(r)?void 0:{components:{layout:e=>a(o,{children:[l(M,{apiVersion:t,languages:r}),e.renderDefault(e)]})}},schema:{types:[...d.map((e=>Z({type:e,apiVersion:t,select:i,languages:r}))),...d.map((e=>te({type:e})))]}}}));export{J as clear,re as internationalizedArray};
//# sourceMappingURL=index.esm.js.map
